
<div class="row">
	<div class="col-lg-12">
		<h1 class="page-header">นำเข้างานใหม่</h1>
	</div>
</div>
	
<div class="panel panel-primary">
	<div class="panel-heading">
		<i class="fa fa-list-alt  fa-fw"></i> แสดงข้อมูลการนำเข้า&nbsp;
        <!-- <div class="btn-group pull-right" ng-show="group0">
	        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
	         	<i class="fa fa-chevron-down"></i>
	        </button>
	        <ul class="dropdown-menu slidedown">
				<li ng-repeat="u in products"><a href="" ng-click="changeProduct(u)">{{ u.productName }}</a></li>
			</ul>
     	</div>
     	<span class="pull-right" ng-show="group0">{{ workingOnProduct.productName }}&nbsp&nbsp</span> -->
     </div>
	<div class="panel-body" style="padding: 3px;">
          	
          	<div class="panel panel-info" style="margin: 0;">
				<div class="panel-heading" nv-file-drop="" uploader="uploader">

              	<!-- <h3>Upload queue</h3>
               <p>Queue length: {{ uploader.queue.length }}</p> -->

               <table class="table">
                   <thead>
                       <tr>
                           <th width="50%">Name</th>
                           <th ng-show="uploader.isHTML5">Size</th>
                           <th ng-show="uploader.isHTML5">Progress</th>
                           <th>Status</th>
                           <th>Actions</th>
                       </tr>
                   </thead>
                   <tbody>
                       <tr ng-repeat="item in uploader.queue">
                           <td><strong>{{ item.file.name }}</strong></td>
                           <td ng-show="uploader.isHTML5" nowrap>{{ item.file.size/1024/1024|number:2 }} MB</td>
                           <td ng-show="uploader.isHTML5">
                               <div class="progress" style="margin-bottom: 0;">
                                   <div class="progress-bar" role="progressbar" ng-style="{ 'width': item.progress + '%' }"></div>
                               </div>
                           </td>
                           <td class="text-center">
                           	<span ng-show="item.isUploading"><i class="fa fa-spinner fa-spin fa-fw"></i></span>
                               <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>
                               <span ng-show="item.isCancel"><i class="glyphicon glyphicon-ban-circle"></i></span>
                               <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span>
                           </td>
                           <td nowrap>
                               <button type="button" class="btn btn-success btn-xs" ng-click="uploadItem(item)" ng-disabled="item.isReady || item.isUploading || item.isSuccess">
                                   <span class="glyphicon glyphicon-upload"></span> Import
                               </button>
                               <!-- <button type="button" class="btn btn-warning btn-xs" ng-click="item.cancel()" ng-disabled="!item.isUploading">
                                   <span class="glyphicon glyphicon-ban-circle"></span> Cancel
                               </button> -->
                               <button type="button" class="btn btn-danger btn-xs" ng-click="item.remove()">
                                   <span class="glyphicon glyphicon-trash"></span> Remove
                               </button>
                           </td>
                       </tr>
                   </tbody>
               </table>
               <div>
                   <div>
                       Queue progress:
                       <div class="progress" style="">
                           <div class="progress-bar" role="progressbar" ng-style="{ 'width': uploader.progress + '%' }"></div>
                       </div>
                   </div>
                   <div class="row">
                    <div class="col-lg-6">
                     <!-- <button type="button" class="btn btn-success btn-s" ng-click="uploader.uploadAll()" ng-disabled="!uploader.getNotUploadedItems().length">
                         <span class="glyphicon glyphicon-upload"></span> Upload all
                     </button> -->
                     <!-- <button type="button" class="btn btn-warning btn-s" ng-click="uploader.cancelAll()" ng-disabled="!uploader.isUploading">
                         <span class="glyphicon glyphicon-ban-circle"></span> Cancel all
                     </button> -->
                     <!-- <button type="button" class="btn btn-danger btn-s" ng-click="uploader.clearQueue()" ng-disabled="!uploader.queue.length">
                         <span class="glyphicon glyphicon-trash"></span> Remove all
                     </button> -->
                    </div>
                    <div class="col-lg-6">
                     <input type="file" class="form-control pull-left" style="width: 300px;" nv-file-select="" uploader="uploader" accept="application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />	  
                       
                      	<button class="btn btn-primary pull-right" type="button" ng-click="showOthersUploadMenu()">นำเข้าข้อมูลเสริม</button>
                      </div>
                     </div>
                 </div>
			</div>
			
			<div class="alert alert-info form-group input-group" style="padding-top: 3px; padding-bottom: 3px; margin: 3px;">
				<span class="input-group-addon" style="border: 0px; background: none; color: #337AB7;">
				{{'pagination.page' | translate}}: {{formData.currentPage}} {{'pagination.of' | translate}} {{numPages}} ({{'pagination.total' | translate}} {{ totalItems }} {{'pagination.items' | translate}})
				</span>
				<pagination ng-change="pageChanged()" total-items="totalItems"
							first-text="{{'pagination.first' | translate}}"
							previous-text="{{'pagination.previous' | translate}}"
							next-text="{{'pagination.next' | translate}}"
							last-text="{{'pagination.last' | translate}}"
							ng-model="formData.currentPage" items-per-page="formData.itemsPerPage"
							max-size="maxSize" class="pagination-sm pull-right" boundary-links="true"
							rotate="false" num-pages="numPages" style="margin: auto;" />
				<span class="input-group-addon" style="padding: 0px 5px 0px 3px; border: 0px; background: none; color: #337AB7;">
					<select style="height: 28px;" ng-options="option for option in [5,10,20,30,40,50,100] track by option" ng-model="formData.itemsPerPage" ng-change="changeItemPerPage()"></select>&nbsp;{{'pagination.per_page' | translate}}								
				</span>
			</div>
			
		</div>

		<div class="table-responsive">
			<table class="table table-striped table-hover" style="margin: 0;">
				<thead>
					<tr style="color: #337AB7;">
						<th width="5%">#</th>
						<th width="50%">ชื่อไฟล์</th>
						<th width="6%">Insert</th>
						<th width="6%">Update</th>				
						<th width="6%">Total</th>
						<th width="12%">วันที่นำเข้า</th>
						<th width="15%">
							<i class="fa fa-tasks fa-lg user-action-icon-primary" ng-click="viewDetail()" title="แสดงข้อมูลทั้งหมด"></i>
						</th>									
					</tr>
				<thead>
				<tbody>
					<tr ng-repeat="data in datas track by $index" style="color: #337AB7;">
						<td>{{ $index + 1 + ((formData.currentPage - 1) * formData.itemsPerPage) }}</td>
						<td>{{ data.fileName }}</td>
						<td>{{ data.insertRowNum | number:0 }}</td>
						<td>{{ data.updateRowNum | number:0 }}</td>
						<td>{{ data.rowNum | number:0 }}</td>
						<td>{{ data.createdDateTime | date:gb_dateTimeFormat }}</td>
						<td>
							<i class="fa fa-times fa-lg user-action-icon-danger" ng-click="deleteItem(data.id)" ng-show="group0">&emsp;</i>
							<i class="fa fa-lg" ng-class="{'fa-check-circle': data.enabled, 'fa-minus-circle': !data.enabled, 'user-action-icon-primary': data.enabled, 'user-action-icon-danger': !data.enabled}" ng-click="updateEnabled(data)"></i>&emsp; 
							<i class="fa fa-download fa-lg user-action-icon-primary" ng-click="download(data.id)" title="Download file ต้นฉบับ" ng-show="group0">&emsp;</i>
							<!-- <i class="fa fa-download fa-lg user-action-icon-primary" ng-click="download(data.id, true)" title="Download file เพื่อตรวจสอบ"></i>&emsp; -->
							<i class="fa fa-bars fa-lg user-action-icon-primary" ng-click="viewDetail(data.id)"></i>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	
	
	</div>
	<div class="panel-footer"></div>
</div>




<!-- Modal -->
 <div class="modal fade" id="myModal" tabindex="-1" role="dialog">
     <div class="modal-dialog">
         <div class="modal-content">
         	<div class="modal-header">
                <button type="button" class="close" ng-click="dismissModal()" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">เลือกเมนูการนำเข้า</h4>
            </div>
            <div class="modal-body">            	    	
				<div class="panel panel-default" style="margin-bottom: 0; margin-top: 0;">
				  <div class="panel-body">
				  
				  	<div class="row" ng-repeat="item in menus"> 
				  		<div class="col-lg-7" style="text-align: center;">
						  	<button class="btn btn-primary col-lg-8" type="button" style="margin-bottom: 3px;" ng-click="gotoImportOthers(item, 'search')"
						  	        editable-text="item.menuName" e-style="margin-bottom: 3px; min-width: 200px;" e-name="menuName" e-form="rowform">{{ item.menuName }}</button>
						  	&nbsp;
				  	        <span class="col-lg-4" editable-checkbox="item.isPgs" e-name="isPgs" e-title="ปกส.?" e-form="rowform"></span>
				  		</div>
				  		<div class="col-lg-5" style="text-align: right;" ng-show="group0">
				  			<form editable-form name="rowform" onbeforesave="saveMenu($data, item, $index)" ng-show="rowform.$visible" class="form-buttons form-inline" shown="inserted == item">
					          <button type="submit" ng-disabled="rowform.$waiting" class="btn btn-success">บันทึก</button>
					          <button type="button" ng-disabled="rowform.$waiting" ng-click="item.id != null ? rowform.$cancel() : cancelNewMenu(item)" class="btn btn-default">ยกเลิก</button>
					        </form>
					        <div class="buttons" ng-show="!rowform.$visible">
					          <i class="fa fa-check-circle fa-lg user-status-enabled-icon" ng-show="item.isPgs" title="ประกันสังคม"></i>&nbsp;&nbsp;&nbsp;
						      <i class="fa fa-desktop fa-lg user-action-icon-primary" title="ตั้งค่าการแสดงผลข้อมูล" ng-click="gotoImportOthers(item, 'setting')" ng-show="group0"></i>
					          <button class="btn btn-info" ng-click="rowform.$show()">แก้ใข</button>
					          <button class="btn btn-danger" ng-click="removeMenu($index, item.id)">ลบ</button>
					        </div>  
				  		</div>
				  	</div>
				  	
				  	<button type="button" class="btn btn-warning btn-circle btn-sm" ng-click="addMenu()" ng-show="group0"><i class="fa fa-plus-square"></i></button>
				  </div>
				</div>
            </div>
           	<div class="modal-footer">
				<button type="button" class="btn btn-default" ng-click="dismissModal()">ปิด</button>
			</div>
         </div>
     </div>
 </div>
<!-- / Modal -->



<!-- Modal -->
 <div class="modal fade" id="importChkModal" tabindex="-1">
 	<form name="importChkForm" novalidate>
	     <div class="modal-dialog">
	         <div class="modal-content">
	         	<div class="modal-header">
	                <button type="button" class="close" ng-click="dismissImportChkModal(true)" aria-hidden="true">&times;</button>
	                <h4 class="modal-title">กรุณาตรวจสอบข้อมูลก่อนการ Import</h4>
	            </div>
	            <div class="modal-body">            	    	
					<div class="panel panel-default" style="margin-bottom: 0; margin-top: 0;">
					  <div class="panel-body" style="padding-bottom: 0; max-height: 300px; overflow-y:auto;">
					  
					  	<tabset>
					  		<tab index="0" heading="คอลัมน์ วันที่">
					  			<table class="table" style="border: 0; margin-bottom: 0;">
							  		<thead>
							  			<tr>
											<th>ชื่อคอลัมน์</th>
											<th>ชนิดข้อมูล</th>
											<th style="color: #C9302C;">เลือกปีที่แสดงใน excel</th>
										</tr>
							  		</thead>
							  		<tbody>
							  			<tr ng-repeat="col in colDateTypes">
							  				<td>{{ col.columnName }}</td>
							  				<td>วันที่</td>
							  				<td style="color: #C9302C;">
							  					<div class="form-group">
									                 <label class="radio-inline">
									                     <input type="radio" name="yearType_{{$index}}" value="BE" ng-model="col.yearType" required>พ.ศ.
									                 </label>
									                 <label class="radio-inline">
									                     <input type="radio" name="yearType_{{$index}}" value="AD" ng-model="col.yearType" required>ค.ศ.
									                 </label>
									            </div>
							  				</td>
							  			</tr>
							  		</tbody>
								</table>	
					  		</tab>
					  		<tab index="0" heading="คอลัมน์ ที่ไม่มีในระบบ">
								<div class="col-xs-12" style="margin-top: 10px;">
									<div class="col-xs-4" ng-repeat="col in colNotFounds" style="margin-bottom: 5px;"><span class="label label-danger" style="font-size: 12px;">{{ col }}</span></div>
								</div>
					  		</tab>
						</tabset>
							
					  </div>
					</div>
	            </div>
	           	<div class="modal-footer">
					<button type="button" class="btn btn-default" ng-click="proceedImport()" ng-disabled="importChkForm.$invalid">Import</button>
				</div>
	         </div>
	     </div>
     </form>
 </div>
<!-- / Modal -->
